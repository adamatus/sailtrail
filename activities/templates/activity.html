{% extends 'base.html' %}
{% load js %}

{% block title_text %}{{ activity.details.name }}{% endblock %}

{% block extra_styles %}
{% css 'activities/css/plots.css' %}
<script>
var units = {{ units|safe }};
</script>
{% css 'seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css' %}
<style>
  .slider.slider-horizontal {
		width: 100%;
	}
</style>
{% endblock %}

{% load static %}
{% block main_section %}
		<h1>{{ activity.details.name }}</h1>
		<p>{{ activity.details.description }}</p>
		<p>Date: {{ activity.stats.date }}</p>
		<p>Start Time: {{ activity.stats.start_time }}</p>
		<p>Duration: {{ activity.stats.duration }}</p>
		<p>Distance: {{ activity.stats.distance }}</p>
		<p>Max speed: {{ activity.stats.max_speed }}</p>
		<a class="btn btn-default" href="{% url 'details' activity.id %}">Edit</a>
		<a class="btn btn-default" href="{% url 'delete_activity' activity.id %}">Delete</a>
		<div class="row">
			<div class="col-md-6" style="padding-top: 1em;">
				<div id="map"></div>
				<input id="time-slider" data-slider-id="time-slider-Slider" type="text">
			</div>
			<div class="col-md-6" style="padding-top: 1em;">
				<div id="speed-plot"></div>
				{% if trimmed %}
				<a href="{% url 'untrim_activity' activity.id %}" class="btn btn-default">Untrim</a>
				{% else %}
				<button class="btn btn-default" id="trim-start">Trim Start</button>
				<button class="btn btn-default" id="trim-end">Trim End</button>
				<form role="form" action="{% url 'trim_activity' activity.id %}" method="POST">


					<input type="hidden" id="input-trim-start" name="trim-start" value='-1'>
					<input type="hidden" id="input-trim-end" name="trim-end" value='-1'>
					{% csrf_token %}
					<button type="submit" class='btn btn-default' id='trim-end'>Trim Activity</button>
				</form>
				{% endif %}
			</div>
		</div>
{% endblock %}

{% block extra_bottom_js %}
		<script>
var pos = {{ pos_json|safe }};
		</script>
	{% js 'd3/d3.min.js' %}
	{% js 'activities/js/track_viewer.js' %}
	{% js 'activities/js/speed_viewer.js' %}
  {% js 'seiyria-bootstrap-slider/dist/bootstrap-slider.min.js' %}
	
		<script>
$('#time-slider').slider({
	max: pos.length,
	value: 0,
	formatter: function(value) {
		if (value < 0) {
			return pos[0].time;
		} else if (value >= pos.length) {
			return pos[pos.length-1].time;
		} else {
			return pos[value].time;
		}
	}
});

TrackViewer.drawmap(pos);
SpeedViewer.drawplot(pos);

$('#time-slider').on('slide', function(slideEvt, data) {
		data = data | slideEvt.value;
		TrackViewer.movemarker(data);
		SpeedViewer.movemarker(data);
});

$(window).on('keydown', function(evnt) {
		if ($.inArray(evnt.keyCode, [37, 39]) >= 0) {
			if (evnt.keyCode == 37) { // Left arrow
				var new_val = $('#time-slider').slider('getValue') - 1;
			}
			if (evnt.keyCode == 39) { // Right arrow
				var new_val = $('#time-slider').slider('getValue') + 1;
			}
			$('#time-slider')
				.slider('setValue', new_val)
				.trigger('slide', [new_val]);
		}
});

$('#trim-start').on('click', function(evnt) {
		var new_val = $('#time-slider').slider('getValue');
		$('#input-trim-start').val(pos[new_val].time);
});

$('#trim-end').on('click', function(evnt) {
		var new_val = $('#time-slider').slider('getValue');
		$('#input-trim-end').val(pos[new_val].time);
});
		</script>
{% endblock %}
