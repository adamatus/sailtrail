{% extends 'base.html' %}

{% block title_text %}Home{% endblock %}

{% block main_section %}
			<h1>SailStats</h1>
			<p>The best place to track your windsports activites</p>
		  <h2>Activity List</h2>
				<hr>
				{% for activity in activities %}
				<div class='activity'>
					<h3><a href="/activities/{{ activity.id }}/">{{ activity.details.name }}</a></h3>
					<p>Sailed by <a href="{% url "user" activity.user.username %}">{{ activity.user.username }}</a> {% if activity.details.private %}<i>Private</i>{% endif %}</p>
					<ul class="list-inline">
						<li class="activity-date">{{ activity.stats.date }}</li>
						<li class="activity-time">{{ activity.stats.start_time }}</li>
						<li class="activity-max-speed">{{ activity.stats.max_speed }}</li>
						<li class="activity-category">{{ activity.details.get_category_display }}</li>
					</ul>
				</div>
				<hr>
				{% endfor %}
				{% url "upload" as upload_url %}
				{% include 'components/upload-modal.html' with header="Upload new activity" action=upload_url %}
				<button id="upload-file-modal-btn" class="btn btn-default" data-toggle="modal" data-target="#upload-modal">Upload New Activity</button>
			</form>
{% endblock %}
{% block extra_bottom_js %}
  <script>
    // Client-side validation of upload form
    $('#upload-file-btn').on('click', function(evnt) {
      var filename = $('#id_upfile').val(),
        extension;

      // No file choosen/entered
      if (filename === "") {
        $("#upload-form .modal-body").prepend('<div class="alert alert-danger alert-dismissible" role="alert">' +
            '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>' +
            '<p>Please choose a file before clicking upload!</p></div>');
        evnt.preventDefault();
      } else {
        extension = filename.slice(filename.length-3).toLowerCase();

        // Unsupported filetype
        if (!(extension === "gpx" || extension === "sbn")) {
          $("#upload-form .modal-body").prepend('<div class="alert alert-danger alert-dismissible" role="alert">' +
              '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>' +
              '<p>Only GPX and SBN files are currently supported.</p></div>');
          evnt.preventDefault();
        }
      }
    });
  {% if form.errors %}
      $('#upload-modal').modal('show');
  {% endif %}
  </script>
{% endblock %}
